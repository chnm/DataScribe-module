<?php
$this->htmlElement('body')->appendAttribute('class', 'datascribe item browse');
$this->headLink()->appendStylesheet($this->assetUrl('css/admin.css', 'Datascribe'));
?>

<?php echo $this->pageTitle($dataset->name(), 1, $this->translate('DataScribe: Dataset'), $this->translate('Browse')); ?>

<?php
if ($dataset->userIsAllowed('update')):
?>
<div id="page-actions">
    <div id="page-action-menu">
        <a href="#" class="expand button" aria-label="<?php echo $this->translate('Expand'); ?>"><?php echo $this->translate('Actions'); ?></a>
        <ul class="collapsible">
            <li><?php echo $dataset->link($this->translate('Edit dataset'), 'edit'); ?></li>
            <li><a href="#" class="sidebar-content" data-sidebar-selector="#sync-dataset"><?php echo $this->translate('Sync dataset'); ?></a></li>
        </ul>
    </div>
</div>
<?php endif; ?>

<?php echo $this->datascribe()->breadcrumbs(); ?>

<div class="browse-controls">
    <?php echo $this->pagination(); ?>
    <?php echo $this->hyperlink($this->translate('Advanced search'), $this->url(null, ['action' => 'search'], ['query' => $this->params()->fromQuery()], true)); ?>
    <?php echo $this->sortSelector([
        [
            'label' => $this->translate('Priority'),
            'value' => 'priority'
        ],
        [
            'label' => $this->translate('Title'),
            'value' => 'title'
        ],
    ]); ?>
    <?php echo $this->filterSelector([
        [
            'label' => $this->translate('All unlocked items'),
            'value' => 'all_unlocked'
        ],
        [
            'label' => $this->translate('All new items'),
            'value' => 'all_new'
        ],
        [
            'label' => $this->translate('All in progress items'),
            'value' => 'all_in_progress'
        ],
        [
            'label' => $this->translate('All items that need initial review'),
            'value' => 'all_need_initial_review'
        ],
        [
            'label' => $this->translate('All items that need review'),
            'value' => 'all_need_review'
        ],
        [
            'label' => $this->translate('All items that are not approved'),
            'value' => 'all_not_approved'
        ],
        [
            'label' => $this->translate('All items that are approved'),
            'value' => 'all_approved'
        ],
        [
            'label' => $this->translate('My new items'),
            'value' => 'my_new'
        ],
        [
            'label' => $this->translate('My in progress items'),
            'value' => 'my_in_progress'
        ],
        [
            'label' => $this->translate('My items that need review'),
            'value' => 'my_need_review'
        ],
        [
            'label' => $this->translate('My items that are not approved'),
            'value' => 'my_not_approved'
        ],
        [
            'label' => $this->translate('My items that are approved'),
            'value' => 'my_approved'
        ],
        [
            'label' => $this->translate('Items I reviewed that need re-review'),
            'value' => 'my_reviewed_and_need_review'
        ],
        [
            'label' => $this->translate('Items I reviewed that are not approved'),
            'value' => 'my_reviewed_and_not_approved'
        ],
        [
            'label' => $this->translate('Items I reviewed that are approved'),
            'value' => 'my_reviewed_and_approved'
        ],
    ]); ?>
</div>

<?php if ($items): ?>

<table class="tablesaw" data-tablesaw-mode="stack">
    <thead>
        <tr>
            <th><?php echo $this->translate('Item'); ?></th>
        </tr>
    </thead>
    <tbody>
    <?php foreach ($items as $item): ?>
        <tr>
            <td>
                <?php echo $item->linkPretty(); ?>
                <ul class="actions">
                    <li><?php echo $this->hyperlink('', '#', [
                        'data-sidebar-content-url' => $item->url('show-details'),
                        'class' => 'o-icon-more sidebar-content',
                        'data-sidebar-selector' => '#show-details',
                        'title' => $this->translate('Details'),
                    ]); ?></li>
                </ul>
            </td>
        </tr>
    <?php endforeach; ?>
    </tbody>
</table>

<div class="browse-controls">
    <?php echo $this->pagination(); ?>
</div>

<?php else: ?>
<div class="no-resources">
    <p>
        <?php echo $this->translate('No items found'); ?>
        <br>
        <?php echo $this->translate('Do you need to sync the dataset? If you have recently synced, the sync job has likely not finished.'); ?>
    </p>
</div>
<?php endif; ?>

<div id="dataset-metadata" class="sidebar always-open">
    <?php echo $this->partial('datascribe/admin/dataset/show-details') ?>
</div>

<div id="show-details" class="sidebar">
    <?php echo $this->hyperlink('', '#', [
        'class' => 'sidebar-close o-icon-close',
        'title' => $this->translate('Close'),
    ]); ?>
    <div class="sidebar-content"></div>
</div>

<div id="sync-dataset" class="sidebar">
    <?php echo $this->hyperlink('', '#', ['class' => 'sidebar-close o-icon-close', 'title' => $this->translate('Close')]); ?>
    <h3><?php echo $this->translate('Sync dataset'); ?></h3>
    <?php if (!$dataset->itemSet()): ?>
    <p class="error"><?php echo $this->translate('This dataset has no item set. Set an item set to enable syncing.'); ?></p>
    <?php endif; ?>
    <p><?php echo $this->translate('Synchronize this dataset with the configured item set. Once synchronized, this dataset will contain every item in the item set. You should synchronize periodically, any time items are added or removed from the item set.'); ?></p>
    <?php
    $syncForm->setAttribute('action', $this->url('admin/datascribe-dataset-id', ['action' => 'sync'], true));
    echo $this->form($syncForm);
    ?>
</div>
