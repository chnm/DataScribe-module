<?php
$this->htmlElement('body')->appendAttribute('class', 'datascribe record browse');
$this->headLink()->appendStylesheet($this->assetUrl('css/admin.css', 'Datascribe'));
$canViewBatchUpdate = $dataset->userIsAllowed('view_datascribe_item_batch_update');
$filters = [];
$sortBy = [
    [
        'label' => $this->translate('Created'),
        'value' => 'created'
    ],
];
?>

<?php echo $this->pageTitle($oItem->title(), 1, $this->translate('DataScribe: Item'), $this->translate('Browse')); ?>

<?php echo $this->datascribe()->breadcrumbs(); ?>

<div class="browse-controls">
    <?php echo $this->pagination(); ?>
    <?php echo $this->hyperlink($this->translate('Advanced search'), $this->url(null, ['action' => 'search'], ['query' => $this->params()->fromQuery()], true)); ?>
    <?php echo $this->sortSelector($sortBy); ?>
    <?php echo $this->filterSelector($filters); ?>
</div>

<?php if ($records): ?>

<form method="post" id="batch-form">

<?php if ($canViewBatchUpdate): ?>
<div class="batch-inputs">
    <select class="batch-actions-select" aria-label="<?php echo $this->translate('Batch actions'); ?>">
        <option value="default"><?php echo $this->translate('Batch actions'); ?></option>
        <option value="update-selected" disabled="true"><?php echo $this->translate('Edit selected'); ?></option>
        <option value="update-all"><?php echo $this->translate('Edit all'); ?></option>
    </select>
    <div class="batch-actions">
        <button type="button" class="default active" disabled="true"><?php echo $this->translate('Go'); ?></button>
        <input type="submit" class="update-selected" name="update_selected" value="<?php echo $this->translate('Go'); ?>" formaction="<?php echo $this->escapeHtml($this->url(null, ['action' => 'batch-edit'], true)); ?>">
        <input type="submit" class="update-all" name="update_all" value="<?php echo $this->translate('Go'); ?>" formaction="<?php echo $this->escapeHtml($this->url(null, ['action' => 'batch-edit-all'], true)); ?>">
        <input type="hidden" name="query" class="batch-query" value="<?php echo $this->escapeHtml(json_encode($this->params()->fromQuery())); ?>">
    </div>
</div>
<?php endif; ?>

<table class="tablesaw batch-edit" data-tablesaw-mode="stack">
    <thead>
        <tr>
            <th class="row-select">
                <?php if ($canViewBatchUpdate): ?>
                <input type="checkbox" class="select-all" aria-label="<?php echo $this->translate('Select all'); ?>">
                <?php endif; ?>
                <?php echo $this->translate('Record #'); ?>
            </th>
            <?php foreach ($dataset->fields() as $field): ?>
            <th><?php echo $field->name(); ?></th>
            <?php endforeach; ?>
        </tr>
    </thead>
    <tbody>
    <?php foreach ($records as $record): ?>
        <?php $values = $record->values(); ?>
        <tr>
            <td>
                <?php if ($canViewBatchUpdate): ?>
                <input type="checkbox" name="record_ids[]" value="<?php echo $item->id(); ?>" aria-label="<?php echo $this->translate('Select records'); ?>">
                <?php endif; ?>
                <?php echo number_format($record->id()); ?>
                <ul class="actions">
                    <?php if ($record->userIsAllowed('update')): ?>
                    <li><?php echo $record->link('', 'edit', [
                        'class' => 'o-icon-edit',
                        'title' => $this->translate('Edit'),
                    ]) ?></li>
                    <?php endif; ?>
                    <li><?php echo $this->hyperlink('', '#', [
                        'data-sidebar-content-url' => $record->url('show-details'),
                        'class' => 'o-icon-more sidebar-content',
                        'data-sidebar-selector' => '#show-details',
                        'title' => $this->translate('Details'),
                    ]); ?></li>
                </ul>
            </td>
            <?php foreach ($dataset->fields() as $field): ?>
            <?php $value = $values[$field->id()] ?? null; ?>
            <?php if (null === $value): ?>
            <td><span style="color: LightGray;"><?php echo $this->translate('null'); ?></span></td>
            <?php else: ?>
            <td><?php echo $value->value([
                'length' => 100,
                'trim_marker' => '<span style="color: LightGray;">...</span>',
                'if_invalid_return' => sprintf('<span style="color: Red;">%s</span>', $this->translate('invalid')),
                'if_empty_return' => sprintf('<span style="color: LightGray;">%s</span>', $this->translate('empty')),
            ]); ?></td>
            <?php endif; ?>
            <?php endforeach; ?>
        </tr>
    <?php endforeach; ?>
    </tbody>
</table>

</form>

<div class="browse-controls">
    <?php echo $this->pagination(); ?>
</div>

<?php else: ?>
<div class="no-resources">
    <p><?php echo $this->translate('No records found.'); ?></p>
</div>
<?php endif; ?>

