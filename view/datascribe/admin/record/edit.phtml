<?php
$this->htmlElement('body')->appendAttribute('class', 'datascribe record edit');
$form->prepare();
$primaryValue = $record->primaryValue();
$primaryValueText = $primaryValue
        ? $primaryValue->value([
            'length' => 25,
            'if_invalid_return' => sprintf('[%s]', $this->translate('[Record]')),
            'if_empty_return' => sprintf('[%s]', $this->translate('[Record]')),
        ])
        : $this->translate('[Record]');
?>
<?php echo $this->pageTitle($primaryValueText, 1, $this->translate('DataScribe: Record'), $this->translate('Edit')); ?>

<?php echo $this->form()->openTag($form); ?>
<?php echo $this->formElement($form->get('csrf')); ?>
<div id="page-actions">
    <?php echo $this->cancelButton(); ?>
    <a href="#" class="delete button"><?php echo $this->translate('Delete'); ?></a>
    <button><?php echo $this->translate('Save'); ?></button>
</div>
<?php echo $this->formRow($form->get('o-module-datascribe:needs_review')); ?>
<?php echo $this->formRow($form->get('o-module-datascribe:needs_work')); ?>
<?php echo $this->formRow($form->get('o-module-datascribe:transcriber_notes')); ?>
<?php echo $this->formRow($form->get('o-module-datascribe:reviewer_notes')); ?>

<?php foreach ($form->get('o-module-datascribe:value')->getFieldsets() as $fieldset): ?>
<fieldset>
    <?php echo sprintf('<legend>%s</legend>', $fieldset->getOption('datascribe_field_name')); ?>
    <?php echo sprintf('<p>%s</p>', $fieldset->getOption('datascribe_field_description')); ?>
    <?php if ($fieldset->has('invalid_data')): ?>
    <?php echo $this->formRow($fieldset->get('invalid_data')); ?>
    <?php endif; ?>
    <?php echo $this->formCollection($fieldset->get('data'), false); ?>
    <?php echo $this->formRow($fieldset->get('is_missing')); ?>
    <?php echo $this->formRow($fieldset->get('is_illegible')); ?>
</fieldset>
<?php endforeach; ?>

<?php echo $this->form()->closeTag(); ?>

<?php echo $this->deleteConfirm($record, 'record'); ?>
